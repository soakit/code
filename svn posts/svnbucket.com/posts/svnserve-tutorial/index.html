<!DOCTYPE html><html lang="zh-cn">
<!-- Mirrored from svnbucket.com/posts/svnserve-tutorial/ by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 23 Nov 2023 10:15:01 GMT -->
<head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> SVN服务器搭建配置教程 · SVN使用教程</title><meta name="description" content="讲解如何搭建svn服务端，使用svnserve提供svn服务，svnadmin创建仓库，配置账号密码、权限文件"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="../favicon.png"><link rel="stylesheet" href="../css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="../atom.xml" title="SVN使用教程"><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="../atom.xml" title="SVN使用教程" type="application/atom+xml">
</head><body><div class="wrap"><header><a href="../index.html" class="logo-link"><img src="../favicon.png" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="../index.html" target="_self" class="nav-list-link">文章列表</a></li><li class="nav-list-item"><a href="https://svnbucket.com/" target="_blank" class="nav-list-link">在线 SVN 服务器</a></li><li class="nav-list-item"><a href="https://www.bilibili.com/video/BV1k4411m7mP" target="_blank" class="nav-list-link">SVN 视频教程</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">SVN服务器搭建配置教程</h1><div class="post-info">2021年4月9日</div><div class="post-content"><p>本篇讲解如何在 Linux 服务器 CentOS 7 搭建 SVN 服务端，创建 SVN 仓库项目，添加项目成员以及配置用户权限。<br>我们将使用 svnserve 提供 svn 服务（另外还有 <a href="../install-svn-apache/index.html">apache搭建SVN</a> 方式）使用<code>svnadmin</code>创建仓库；</p>
<span id="more"></span>

<blockquote>
<p>如果你闲搭建自己的SVN服务端以及配置比较麻烦，推荐你使用 <a href="https://svnbucket.com/">SVNBucket</a>，提供了可视化的操作界面，所有操作都变得非常简单</p>
</blockquote>
<h6 id="服务器上安装-Subversion"><a href="#服务器上安装-Subversion" class="headerlink" title="服务器上安装 Subversion"></a>服务器上安装 Subversion</h6><p>首先我们要安装 SVN 的服务端，Apache Subversion 提供了服务端和客户端。<br>如果你还没安装好 Subversion 请查看 <a href="../centos-install-svn/index.html">SVN服务端安装教程</a></p>
<h6 id="创建-SVN-仓库"><a href="#创建-SVN-仓库" class="headerlink" title="创建 SVN 仓库"></a>创建 SVN 仓库</h6><p>为确保你已正确安装好 SVN ，请在命令行输入 <code>svnadmin help</code>，如果看到如下内容，说明是没问题的</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># svnadmin help</span></span><br><span class="line">general usage: svnadmin SUBCOMMAND REPOS_PATH  [ARGS &amp; OPTIONS ...]</span><br><span class="line">Subversion repository administration tool.</span><br><span class="line">Type <span class="string">&#x27;svnadmin help &lt;subcommand&gt;&#x27;</span> <span class="keyword">for</span> <span class="built_in">help</span> on a specific subcommand.</span><br><span class="line">Type <span class="string">&#x27;svnadmin --version&#x27;</span> to see the program version and FS modules.</span><br><span class="line"></span><br><span class="line">Available subcommands:</span><br><span class="line">   crashtest</span><br><span class="line">   create</span><br><span class="line">   delrevprop</span><br><span class="line">   deltify</span><br><span class="line">   dump</span><br><span class="line">   dump-revprops</span><br><span class="line">   freeze</span><br><span class="line">   <span class="built_in">help</span> (?, h)</span><br><span class="line">   hotcopy</span><br><span class="line">   info</span><br><span class="line">   list-dblogs</span><br><span class="line">   list-unused-dblogs</span><br><span class="line">   load</span><br><span class="line">   load-revprops</span><br><span class="line">   lock</span><br><span class="line">   lslocks</span><br><span class="line">   lstxns</span><br><span class="line">   pack</span><br><span class="line">   recover</span><br><span class="line">   rmlocks</span><br><span class="line">   rmtxns</span><br><span class="line">   setlog</span><br><span class="line">   setrevprop</span><br><span class="line">   setuuid</span><br><span class="line">   unlock</span><br><span class="line">   upgrade</span><br><span class="line">   verify</span><br></pre></td></tr></table></figure>

<p><code>svnadmin</code>是一个服务端的 SVN 管理工具，我们可以用它来创建仓库。<br>我们的仓库通常都会有很多个，所以我们创建一个目录来存放，假设我以<code>/root/repos/</code>作为我的仓库父目录，执行下面的命令：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /root</span><br><span class="line"><span class="comment"># 创建目录</span></span><br><span class="line">mkdir repos</span><br></pre></td></tr></table></figure>
<p>接下来我们创建一个仓库<code>test</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 先进去repos目录</span></span><br><span class="line"><span class="built_in">cd</span> repos</span><br><span class="line"><span class="comment"># 创建仓库test</span></span><br><span class="line">svnadmin create <span class="built_in">test</span></span><br><span class="line"><span class="comment"># 进入仓库查看文件列表</span></span><br><span class="line"><span class="built_in">cd</span> <span class="built_in">test</span></span><br><span class="line">ls</span><br></pre></td></tr></table></figure>
<p>输出如下，表示创建成功，<br><img src="Wo9vd1pTsqMy2m6.jpg" alt="svnadmin 创建svn仓库"></p>
<p>几个关键目录介绍下<br><code>conf</code>目录是存放配置文件的，配置用户权限，用户账号密码，svnserve配置都在这里配置。<br><code>db</code>这里存放我们平常提交的数据文件，文件内容都是经过处理的，看不懂里面的内容<br><code>hooks</code>这里是存放钩子配置的，暂时不用管这里</p>
<p>我们的重点是在<code>conf</code>目录，里面几个配置文件如下：<br><code>authz</code> 是权限配置文件，用来配置用户什么路径有读写权限<br><code>hooks-env.tmpl</code> 是钩子环境变量配置文件的模版，我们暂时用不到，可以忽略<br><code>passwd</code> 用来配置用户的帐号密码<br><code>svnserve.conf</code> 是subversion的总配置</p>
<p>现在我们什么配置都不用修改先，我们先启动 svn 服务：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 启动svn服务，-d 表示在后台运行，-r 表示仓库根目录</span></span><br><span class="line">svnserve -d -r /root/repos/</span><br></pre></td></tr></table></figure>
<p>如果没报错，说明就启动成功了。<br>这时候我们就可以使用 SVN 客户端来检出仓库了。如果你还不会使用 SVN 客户端，可以查看下 <a href="../svn-tutorial/index.html">SVN使用教程</a><br>你会发现任何人都可以检出代码，但是无法提交代码，这是因为 svn 仓库默认就是未登录用户有读取权限。</p>
<p>接下来我们修改配置，限制只有登录用户才能检出代码，不然太危险了。</p>
<p>打开<code>test/conf/svnserve.conf</code> 文件，替换内容如下；</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">general</span>]</span><br><span class="line"><span class="comment"># 未登录用户无权限</span></span><br><span class="line"><span class="string">anon-access</span> <span class="string">=</span> <span class="string">none</span></span><br><span class="line"><span class="comment"># 已登录用户有读写权限</span></span><br><span class="line"><span class="string">auth-access</span> <span class="string">=</span> <span class="string">write</span></span><br><span class="line"><span class="comment"># 密码配置文件</span></span><br><span class="line"><span class="string">password-db</span> <span class="string">=</span> <span class="string">passwd</span></span><br><span class="line"><span class="comment"># 权限配置文件</span></span><br><span class="line"><span class="string">authz-db</span> <span class="string">=</span> <span class="string">authz</span></span><br></pre></td></tr></table></figure>
<p>注意，这个文件里面有非常多的注释内容，我上面这个配置内容是简化后的，我们直接把原来的全部删除，替换为我们这个就行了。<br>保存配置后，不需要重启服务器，我们重新checkout下，这时候就会弹出登录界面了，说明配置生效了。</p>
<p>但是我们还没有用户名密码，接下来我们设置下用户名和密码。<br>打开<code>test/conf/passwd</code>文件，我们增加一个用户名hello，密码123456，最后内容如下：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="string">users</span>]</span><br><span class="line"><span class="comment"># harry = harryssecret</span></span><br><span class="line"><span class="comment"># sally = sallyssecret</span></span><br><span class="line"><span class="string">hello</span> <span class="string">=</span> <span class="number">123456</span></span><br></pre></td></tr></table></figure>

<p>这时候我们直接去 checkout 会提示没有权限<code>Error Authorization failed</code><br>这是因为我们配置了<code>authz-db = authz</code>，这个表示用户的权限需要读取这个配置文件去判断。<br>如果我们去掉这个配置，则登录用户对整个仓库都有读写权限。</p>
<p>接下来我们给 hello 用户配置路径权限，打开<code>test/conf/authz</code>文件，写入如下内容：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这是一个权限配置文件</span></span><br><span class="line"><span class="comment"># 每行配置一个权限</span></span><br><span class="line"><span class="comment"># 用$authenticated表示所有登录用户</span></span><br><span class="line"><span class="comment"># 用$anonymous表示所有未登录用户</span></span><br><span class="line"><span class="comment"># *号表示任何用</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 这里配置分组，把相同权限的人归为一个组，方便配置权限</span></span><br><span class="line">[<span class="string">groups</span>]</span><br><span class="line"><span class="comment"># 假设我们创建一个开发人员组</span></span><br><span class="line"><span class="comment"># developers = zhangsan,lisi</span></span><br><span class="line"><span class="comment"># 管理员分组</span></span><br><span class="line"><span class="comment"># admin = wangzong,ruhua</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置根目录权限，管理员分组有根目录的读写权限，hello用户只有读权限</span></span><br><span class="line">[<span class="string">test:/</span>]</span><br><span class="line"><span class="string">@admin</span> <span class="string">=</span> <span class="string">rw</span></span><br><span class="line"><span class="string">hello</span> <span class="string">=</span> <span class="string">r</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 给开发人员配置服务端源码路径的读写权限，hello有读写权限</span></span><br><span class="line">[<span class="string">test:/server/src</span>]</span><br><span class="line"><span class="string">@developers</span> <span class="string">=</span> <span class="string">rw</span></span><br><span class="line"><span class="string">hello</span> <span class="string">=</span> <span class="string">rw</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>把配置文件保存好，这样我们的hello用户就有了根目录<code>/</code>的读权限，并且有了<code>/server/src</code>的读写权限了。<br>另外我们还配置了几个分组，不过那些用户都是假的，需要在<code>passwd</code>文件里先配置这些用户才能使用，这里只是给你演示下如何配置分组</p>
<p>好了，完整的 SVN 服务端搭建和配置就完成了，日常工作中，如果项目比较多、用户多，会需要经常修改配置文件，要多注意安全，不然容易导致仓库访问不到。<br>你也可以选择使用 <a href="https://svnbucket.com/">SVNBucket</a>， 提供了可视化的配置界面，用户创建、管理，权限配置都是直接在web端操作的，方便安全。</p>
</div></article></div></main><footer><div class="paginator"><a href="../subversion-authz-conf/index.html" class="prev">上一篇</a><a href="../svn-hooks-introduce/index.html" class="next">下一篇</a></div><div class="copyright"><p>© 2015 - 2023 <a href="https://svnbucket.com/posts">SVNBucket</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="http://cdn.bootcss.com/mathjax/2.7.0/MathJaxb198.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-3Y0CZFQQH6"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-3Y0CZFQQH6');
</script><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "../../../hm.baidu.com/hmd41d.js?" + '58e98965a39ff5dab9a778a4a30eca6b';
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();

</script><script>//- 图片预览
let imgs = [...document.querySelectorAll("main img")]
let wrap = document.querySelector(".wrap")
imgs.forEach(img => {
	img.addEventListener("click", previewImg)
})
function previewImg(){
	let wrapper = document.createElement("div")
	wrapper.id = "preview-image-wrapper"
	let img = new Image()
	img.src = this.src
	wrapper.appendChild(img)
	document.body.appendChild(wrapper)

	//隐藏滚动条，防抖
	document.documentElement.style.overflowY = "hidden"
	wrap.style.paddingRight = "20px"

	wrapper.addEventListener("click", function(){
		document.body.removeChild(wrapper)
		wrapper = null
		document.documentElement.style.overflowY = "visible"
		wrap.style = ""
	})
}</script></body>
<!-- Mirrored from svnbucket.com/posts/svnserve-tutorial/ by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 23 Nov 2023 10:15:01 GMT -->
</html>